(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();class P extends AudioWorkletNode{static SPATIAL_MAX_CHANNELS=32;static async create(t){try{await t.audioWorklet.addModule("resonator-processor.js")}catch{}return new P(t)}constructor(t){super(t,"resonator-processor",{numberOfInputs:0,numberOfOutputs:3,outputChannelCount:[2,2,P.SPATIAL_MAX_CHANNELS],parameterData:{nbranches:4,noiseLevel:.03,noiseType:1,lfoEnabled:1,lfoRate:.1,lfoDepth:.7,lfoWave:0,rmix:1,quantize:0,exciterCutoff:4e3,exciterHP:50,rainEnabled:1,rainGain:.62,rainRate:.83,rainDurMs:61,rainSpread:.71,rainCenter:.49,rainLimbs:10,monitorExciter:0,groupEnabled:0,groupSplit:0,octaves:0,freqScale:1,freqCenter:0,decayScale:1,exciterBandQNoise:30,exciterBandQRain:30}})}get nbranches(){return this.parameters.get("nbranches")}get noiseLevel(){return this.parameters.get("noiseLevel")}get noiseType(){return this.parameters.get("noiseType")}get lfoEnabled(){return this.parameters.get("lfoEnabled")}get lfoRate(){return this.parameters.get("lfoRate")}get lfoDepth(){return this.parameters.get("lfoDepth")}get lfoWave(){return this.parameters.get("lfoWave")}get rmix(){return this.parameters.get("rmix")}get quantize(){return this.parameters.get("quantize")}get exciterCutoff(){return this.parameters.get("exciterCutoff")}get exciterHP(){return this.parameters.get("exciterHP")}get groupEnabled(){return this.parameters.get("groupEnabled")}get groupSplit(){return this.parameters.get("groupSplit")}get octaves(){return this.parameters.get("octaves")}get rainEnabled(){return this.parameters.get("rainEnabled")}get rainGain(){return this.parameters.get("rainGain")}get rainRate(){return this.parameters.get("rainRate")}get rainDurMs(){return this.parameters.get("rainDurMs")}get rainSpread(){return this.parameters.get("rainSpread")}get rainCenter(){return this.parameters.get("rainCenter")}get rainLimbs(){return this.parameters.get("rainLimbs")}get monitorExciter(){return this.parameters.get("monitorExciter")}get freqScale(){return this.parameters.get("freqScale")}get freqCenter(){return this.parameters.get("freqCenter")}get decayScale(){return this.parameters.get("decayScale")}get exciterBandQNoise(){return this.parameters.get("exciterBandQNoise")}get exciterBandQRain(){return this.parameters.get("exciterBandQRain")}setBranchParams(t,{freq:n,decay:l,amp:o,pan:r}){this.port.postMessage({type:"setBranchParams",index:t,params:{freq:n,decay:l,amp:o,pan:r}})}setAllBranches(t){this.port.postMessage({type:"setAllBranches",branches:t})}setScale({name:t,root:n}){this.port.postMessage({type:"setScale",name:t,root:n})}}let m=null,a=null;const N=40;let w=0;const X=["noiseLevel","noiseType","lfoEnabled","lfoRate","lfoDepth","lfoWave","exciterCutoff","exciterHP","exciterBandQNoise","exciterBandQRain","monitorExciter","rainEnabled","rainGain","rainRate","rainDurMs","rainSpread","rainCenter","rainLimbs"];let j=!1,V=null;function H(e){return document.getElementById(e)}const G="uiStateV1",z="exciterStateV1";function _(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch{return null}}function ce(e,t){try{localStorage.setItem(e,JSON.stringify(t||{}))}catch{}}function Ce(e,t,n){if(e)if(e.type==="checkbox")e.checked=!!n,e.dispatchEvent(new Event("change",{bubbles:!0}));else{e.value=String(n);const l=e.tagName==="SELECT"?"change":"input";e.dispatchEvent(new Event(l,{bubbles:!0}))}}const Te=["rmix","nbranches","freqScale","octaves","freqCenter","decayScale","groupEnabled","groupSplit","scaleRoot","scaleName"];function W(e){const n={..._(G)||{},...e};ce(G,n)}function Ie(){const e=_(G);if(e)for(const t of Te){if(!(t in e))continue;const n=H(t);n&&Ce(n,t,e[t])}}function de(e){const n={..._(z)||{},...e};ce(z,n)}function ue(){return _(z)||null}function ke(e,t){if(!a||!m)return;const n=m.currentTime;switch(e){case"noiseLevel":a.noiseLevel&&a.noiseLevel.setValueAtTime(parseFloat(t),n);break;case"noiseType":a.noiseType&&a.noiseType.setValueAtTime(parseInt(t,10),n);break;case"lfoEnabled":a.lfoEnabled&&a.lfoEnabled.setValueAtTime(t?1:0,n);break;case"lfoRate":a.lfoRate&&a.lfoRate.setValueAtTime(parseFloat(t),n);break;case"lfoDepth":a.lfoDepth&&a.lfoDepth.setValueAtTime(parseFloat(t),n);break;case"lfoWave":a.lfoWave&&a.lfoWave.setValueAtTime(parseInt(t,10),n);break;case"exciterCutoff":a.exciterCutoff&&a.exciterCutoff.setValueAtTime(parseFloat(t),n);break;case"exciterHP":a.exciterHP&&a.exciterHP.setValueAtTime(parseFloat(t),n);break;case"exciterBandQNoise":a.exciterBandQNoise&&a.exciterBandQNoise.setValueAtTime(parseFloat(t),n);break;case"exciterBandQRain":a.exciterBandQRain&&a.exciterBandQRain.setValueAtTime(parseFloat(t),n);break;case"monitorExciter":a.monitorExciter&&a.monitorExciter.setValueAtTime(t?1:0,n);break;case"rainEnabled":a.rainEnabled&&a.rainEnabled.setValueAtTime(t?1:0,n);break;case"rainGain":a.rainGain&&a.rainGain.setValueAtTime(parseFloat(t),n);break;case"rainRate":a.rainRate&&a.rainRate.setValueAtTime(parseFloat(t),n);break;case"rainDurMs":a.rainDurMs&&a.rainDurMs.setValueAtTime(parseFloat(t),n);break;case"rainSpread":a.rainSpread&&a.rainSpread.setValueAtTime(parseFloat(t),n);break;case"rainCenter":a.rainCenter&&a.rainCenter.setValueAtTime(parseFloat(t),n);break;case"rainLimbs":a.rainLimbs&&a.rainLimbs.setValueAtTime(parseInt(t,10),n);break}}function Ae(){const e={};for(const t of X){const n=H(t);if(!n){t==="noiseLevel"&&a&&a.noiseLevel&&(e[t]=a.noiseLevel.value);continue}n.type==="checkbox"?e[t]=!!n.checked:e[t]=n.value}return e}function O(e){if(!V)return;let t=e||Ae();const n=ue();n&&(t={...n,...t}),V.postMessage({type:"state",source:"main",state:t,partial:!!e})}function Q(e,t){const n=H(e);if(!n){ke(e,t);return}j=!0;try{if(n.type==="checkbox")n.checked=!!t,n.dispatchEvent(new Event("change",{bubbles:!0}));else{n.value=String(t);const l=n.tagName==="SELECT"?"change":"input";n.dispatchEvent(new Event(l,{bubbles:!0}))}}finally{j=!1}de({[e]:t})}function Me(){if(!V&&!(typeof BroadcastChannel>"u")){V=new BroadcastChannel("exciter-controls"),V.onmessage=e=>{const t=e.data||{};if(t.source!=="main")if(t.type==="set"&&t.id)Q(t.id,t.value);else if(t.type==="setMultiple"&&t.values){const n=Object.entries(t.values);for(const[l,o]of n)Q(l,o)}else t.type==="requestState"&&O()};for(const e of X){const t=H(e);if(!t)continue;const n=()=>{if(j)return;const l=t.type==="checkbox"?!!t.checked:t.value;de({[e]:l}),O({[e]:l})};t.addEventListener("input",n),t.addEventListener("change",n)}}}const me=25,pe=8e3;function K(e){const t=me,n=pe,l=Math.min(Math.max(e,t),n);return Math.log(l/t)/Math.log(n/t)}function fe(e){const t=me,n=pe,l=Math.min(Math.max(e,0),1);return t*Math.pow(n/t,l)}function R(e,t){return Math.random()*(t-e)+e}function ge(e){return Math.round(e*100)/100}function be(e){return Math.max(0,Math.min(1,e))}function $(e,t,n){return n>t?be((e-t)/(n-t)):0}function ee(e,t,n){const l=be(e);return t+l*(n-t)}const he="randomizerConfigV1",q=[{id:"rmix",label:"Mix (rmix)",kind:"float",min:0,max:1,step:.001},{id:"nbranches",label:"Branch count",kind:"int",min:1,max:N,step:1},{id:"freqScale",label:"Freq Scale",kind:"float",min:.25,max:4,step:.01},{id:"octaves",label:"Octave Transpose",kind:"int",min:-4,max:2,step:1},{id:"freqCenter",label:"Freq Center (Hz)",kind:"int",min:-2e3,max:2e3,step:1},{id:"decayScale",label:"Decay Scale",kind:"float",min:.25,max:4,step:.01},{id:"groupEnabled",label:"Group Mode",kind:"bool"},{id:"groupSplit",label:"Group Split",kind:"int",min:0,max:N,step:1},{id:"scaleRoot",label:"Scale Root",kind:"select",options:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]},{id:"scaleName",label:"Scale",kind:"select",options:["off","chromatic","major","minor","harmonicMinor","melodicMinor","dorian","phrygian","lydian","mixolydian","locrian","pentatonicMajor","pentatonicMinor","blues","wholeTone","octatonic12","octatonic21"]},{id:"noiseLevel",label:"Noise Level",kind:"float",min:0,max:.5,step:.001},{id:"noiseType",label:"Noise Type",kind:"int",min:0,max:3,step:1},{id:"lfoEnabled",label:"LFO Enable",kind:"bool"},{id:"lfoRate",label:"LFO Rate (Hz)",kind:"float",min:.1,max:20,step:.01},{id:"lfoDepth",label:"LFO Depth",kind:"float",min:0,max:1,step:.01},{id:"lfoWave",label:"LFO Wave",kind:"int",min:0,max:3,step:1},{id:"exciterCutoff",label:"Exciter LP (Hz)",kind:"int",min:50,max:2e4,step:1},{id:"exciterHP",label:"Exciter HP (Hz)",kind:"int",min:10,max:2e3,step:1},{id:"exciterBandQNoise",label:"Exciter Band Q (Noise)",kind:"float",min:.5,max:80,step:.5},{id:"exciterBandQRain",label:"Exciter Band Q (Rain)",kind:"float",min:.5,max:80,step:.5},{id:"monitorExciter",label:"Monitor Exciter Only",kind:"bool"},{id:"rainEnabled",label:"Rain Enabled",kind:"bool"},{id:"rainGain",label:"Rain Gain",kind:"float",min:0,max:1,step:.01},{id:"rainRate",label:"Rain Rate (Hz)",kind:"float",min:.1,max:40,step:.01},{id:"rainDurMs",label:"Drop Duration (ms)",kind:"int",min:1,max:200,step:1},{id:"rainSpread",label:"Spread",kind:"float",min:0,max:1,step:.01},{id:"rainCenter",label:"Center",kind:"float",min:0,max:1,step:.01},{id:"rainLimbs",label:"N Limbs",kind:"int",min:1,max:10,step:1},{id:"noiseLP",label:"Mixer Noise LP (Hz)",kind:"int",min:50,max:2e4,step:1}];function U(){try{const e=localStorage.getItem(he);return e?JSON.parse(e):null}catch{return null}}function F(e){try{localStorage.setItem(he,JSON.stringify(e))}catch{}}function Y(){const e={};for(const t of q){const n={enabled:!1,depEnabled:!1,depTarget:"",depBias:0};t.kind==="bool"||t.kind==="select"?e[t.id]={...n}:e[t.id]={...n,min:t.min,max:t.max,step:t.step}}return e.rmix.enabled=!0,e.rmix.min=.7,e.rmix.max=1,e.rmix.step=.001,e.nbranches.enabled=!0,e.nbranches.min=5,e.nbranches.max=N,e.nbranches.step=1,e.octaves.enabled=!0,e.octaves.min=-2,e.octaves.max=2,e.octaves.step=1,e.decayScale.enabled=!0,e.decayScale.min=.3,e.decayScale.max=4,e.decayScale.step=.01,e.groupEnabled.enabled=!1,e.groupSplit.enabled=!1,e.groupSplit.min=0,e.groupSplit.max=N,e.groupSplit.step=1,e.scaleRoot.enabled=!1,e.scaleName.enabled=!1,e}function Z(e){const t=e?JSON.parse(JSON.stringify(e)):{};for(const n of q){const l={enabled:!1,depEnabled:!1,depTarget:"",depBias:0};let o=t[n.id];if(o||(o=n.kind==="bool"||n.kind==="select"?{...l}:{...l,min:n.min,max:n.max,step:n.step}),n.kind!=="bool"&&n.kind!=="select"){let r=parseFloat(o.min),i=parseFloat(o.max);isNaN(r)&&(r=n.min),isNaN(i)&&(i=n.max),r=Math.max(n.min,Math.min(n.max,r)),i=Math.max(n.min,Math.min(n.max,i)),i>r||(r=n.min,i=n.max),o.min=r,o.max=i,o.step=n.step}t[n.id]={...l,...o}}return t}function Re(){const e=document.getElementById("randomizerPanel");if(!e)return;const t=Z(U()||Y()),n=o=>{const r=document.createElement("div");r.className="rand-card";const i=document.createElement("h3");return i.textContent=o,r.appendChild(i),r},l=[{title:"Main",ids:["rmix","nbranches","freqScale","octaves","freqCenter","decayScale","groupEnabled","groupSplit","scaleRoot","scaleName"]},{title:"Exciter",ids:["noiseLevel","noiseType","lfoEnabled","lfoRate","lfoDepth","lfoWave","exciterCutoff","exciterHP","exciterBandQNoise","exciterBandQRain","monitorExciter","rainEnabled","rainGain","rainRate","rainDurMs","rainSpread","rainCenter","rainLimbs"]},{title:"Mixer",ids:["noiseLP"]}];e.innerHTML="";for(const o of l){const r=n(o.title);for(const i of o.ids){const s=q.find(x=>x.id===i);if(!s)continue;const u=document.createElement("div");u.className="rand-row";const f=document.createElement("input");f.type="checkbox",f.checked=!!(t[i]&&t[i].enabled),f.addEventListener("change",()=>{t[i]=t[i]||{},t[i].enabled=!!f.checked,F(t)}),u.appendChild(f);const g=document.createElement("div");if(s.kind==="bool"||s.kind==="select"){const x=document.createElement("label");x.textContent=s.label+(s.kind==="select"?" (random pick)":""),g.appendChild(x)}else{const x=document.createElement("label");x.textContent=s.label,g.appendChild(x);const y=document.createElement("div");y.className="range";const d=document.createElement("input");d.type="number",d.step=String(s.step||1),d.value=String((t[i]&&t[i].min)!=null?t[i].min:s.min);const c=document.createElement("input");c.type="number",c.step=String(s.step||1),c.value=String((t[i]&&t[i].max)!=null?t[i].max:s.max);const p=()=>{const S=parseFloat(d.value),A=parseFloat(c.value);t[i]||(t[i]={enabled:!1}),t[i].min=isNaN(S)?s.min:S,t[i].max=isNaN(A)?s.max:A,t[i].step=s.step,F(t)};d.addEventListener("input",p),c.addEventListener("input",p),y.appendChild(d),y.appendChild(c),g.appendChild(y)}const h=document.createElement("div");h.className="dep";const b=document.createElement("input");b.type="checkbox",b.checked=!!(t[i]&&t[i].depEnabled),b.title="Enable dependency";const T=document.createElement("span");T.textContent="Dependency";const E=document.createElement("select"),B=document.createElement("option");B.value="",B.textContent="(choose target)",E.appendChild(B);for(const x of q){if(x.id===i)continue;const y=document.createElement("option");y.value=x.id,y.textContent=x.label,E.appendChild(y)}E.value=t[i]&&t[i].depTarget||"";const C=document.createElement("div");C.className="bias";const I=document.createElement("span");I.textContent="Bias";const v=document.createElement("input");v.type="range",v.min="-1",v.max="1",v.step="0.01",v.value=String(t[i]&&typeof t[i].depBias=="number"?t[i].depBias:0);const k=document.createElement("span"),L=()=>{k.textContent=String(Math.round(parseFloat(v.value)*100))+"%"};L(),v.addEventListener("input",()=>{L(),t[i]||(t[i]={enabled:!1}),t[i].depBias=parseFloat(v.value),F(t)}),b.addEventListener("change",()=>{t[i]=t[i]||{},t[i].depEnabled=!!b.checked,F(t)}),E.addEventListener("change",()=>{t[i]=t[i]||{},t[i].depTarget=E.value,F(t)}),h.appendChild(b),h.appendChild(T),h.appendChild(E),C.appendChild(I),C.appendChild(v),C.appendChild(k),h.appendChild(C),g.appendChild(h),u.appendChild(g),r.appendChild(u)}e.appendChild(r)}}function Le(e,t){if(!t||!t.enabled)return null;if(e.kind==="bool")return Math.random()<.5;if(e.kind==="select"){const r=e.options||[];return r.length?r[Math.floor(Math.random()*r.length)]:null}const n=parseFloat(t.min),l=parseFloat(t.max);if(!(l>n))return null;let o=R(n,l);if(e.kind==="int"&&(o=Math.round(o)),e.step){const r=e.step;o=Math.round(o/r)*r}return o}function Ve(){const e=Z(U()||Y()),t=[...q];t.sort((r,i)=>r.id==="nbranches"?-1:i.id==="nbranches"?1:0);const n={};for(const r of t){const i=Le(r,e[r.id]);i!=null&&(n[r.id]=i)}if(n.groupSplit!=null){const r=n.nbranches!=null?n.nbranches:document.getElementById("nbranches")?parseInt(document.getElementById("nbranches").value,10):null;r!=null&&(n.groupSplit=Math.max(0,Math.min(r,n.groupSplit|0)))}const l=Object.fromEntries(q.map(r=>[r.id,r]));for(const r of Object.keys(e)){const i=e[r];if(!i||!i.depEnabled)continue;const s=i.depTarget;if(!s||s===r||n[r]==null||n[s]==null)continue;const u=l[r],f=l[s];if(!u||!f)continue;const g=e[r],h=e[s],b=u.kind==="bool"||u.kind==="select"?0:g&&g.min!=null?g.min:u.min,T=u.kind==="bool"||u.kind==="select"?1:g&&g.max!=null?g.max:u.max,E=f.kind==="bool"||f.kind==="select"?0:h&&h.min!=null?h.min:f.min,B=f.kind==="bool"||f.kind==="select"?1:h&&h.max!=null?h.max:f.max,C=$(n[r],b,T),I=typeof i.depBias=="number"?Math.max(-1,Math.min(1,i.depBias)):0,v=Math.abs(I),k=$(n[s],E,B),L=I<0?0:1,x=v*C,y=k+(L-k)*x;n[s]=f.kind==="bool"?y>=.5:f.kind==="int"?Math.round(ee(y,E,B)):ee(y,E,B)}const o=Object.entries(n);for(const[r,i]of o)r!=="noiseLP"&&Q(r,i);if(n.noiseLP!=null){if(window._mixerApi&&typeof window._mixerApi.setNoiseLP=="function")try{window._mixerApi.setNoiseLP(n.noiseLP)}catch{}try{typeof BroadcastChannel<"u"&&new BroadcastChannel("mixer").postMessage({type:"setNoiseLP",value:n.noiseLP})}catch{}}try{if(V){const r={};for(const i of X)n[i]!=null&&(r[i]=n[i]);Object.keys(r).length&&V.postMessage({type:"setMultiple",values:r,source:"main"})}}catch{}document.getElementById("rmix")&&D()}function Ne(e){const t=document.createElement("div");t.className="grid row",t.dataset.index=String(e);const n=document.createElement("span");n.textContent=String(e+1),t.appendChild(n);const l=document.createElement("input");l.type="range",l.min="0",l.max="1",l.step="0.001",l.value=String(K(440)),l.dataset.role="freq",t.appendChild(l);const o=document.createElement("input");o.type="range",o.min="50",o.max="3000",o.step="1",o.value="400",o.dataset.role="decay",t.appendChild(o);const r=document.createElement("input");r.type="range",r.min="0",r.max="1",r.step="0.001",r.value="0.2",r.dataset.role="amp",t.appendChild(r);const i=document.createElement("input");i.type="range",i.min="-1",i.max="1",i.step="0.001",i.value="0",i.dataset.role="pan",t.appendChild(i);const s=()=>{if(!a)return;const u={freq:fe(parseFloat(l.value)),decay:parseFloat(o.value),amp:parseFloat(r.value),pan:parseFloat(i.value)};a.setBranchParams(e,u)};return l.addEventListener("input",s),o.addEventListener("input",s),r.addEventListener("input",s),i.addEventListener("input",s),t}function J(e){document.querySelectorAll("#branches .row").forEach((n,l)=>{n.style.display=l<e?"grid":"none"})}function qe(e){const t=[],n=document.querySelectorAll("#branches .row");for(let l=0;l<e;l+=1){const o=Math.round(R(100,2e3)),r=Math.round(R(100,800)),i=ge(R(.005,.05)),s=R(-1,1);t.push({freq:o,decay:r,amp:i,pan:s});const u=n[l];u.querySelector('input[data-role="freq"]').value=String(K(o)),u.querySelector('input[data-role="decay"]').value=String(r),u.querySelector('input[data-role="amp"]').value=String(i),u.querySelector('input[data-role="pan"]').value=String(s)}a&&a.setAllBranches(t)}function Fe(e,t){const n=document.querySelectorAll("#branches .row"),l=Math.max(0,e|0),o=Math.min(N,t|0);for(let r=l;r<o;r+=1){const i=Math.round(R(100,2e3)),s=Math.round(R(100,800)),u=ge(R(.005,.05)),f=R(-1,1),g=n[r];if(!g)continue;const h=g.querySelector('input[data-role="freq"]'),b=g.querySelector('input[data-role="decay"]'),T=g.querySelector('input[data-role="amp"]'),E=g.querySelector('input[data-role="pan"]');h&&(h.value=String(K(i))),b&&(b.value=String(s)),T&&(T.value=String(u)),E&&(E.value=String(f)),a&&a.setBranchParams(r,{freq:i,decay:s,amp:u,pan:f})}}function Ee(){const e=parseInt(document.getElementById("nbranches").value,10)||4,t=document.querySelectorAll("#branches .row"),n=[];for(let l=0;l<e;l+=1){const o=t[l],r=parseFloat(o.querySelector('input[data-role="freq"]').value),i=parseFloat(o.querySelector('input[data-role="decay"]').value),s=parseFloat(o.querySelector('input[data-role="pan"]').value),u=o.querySelector('input[data-role="amp"]');u&&(u.value="0.2"),n.push({freq:fe(r),decay:i,amp:.2,pan:s})}a&&a.setAllBranches(n),D()}function D(){const e=t=>document.getElementById(t);e("noiseLevel")&&(e("noiseLevelVal").textContent=Number(e("noiseLevel").value).toFixed(2)),e("rmixVal").textContent=Number(e("rmix").value).toFixed(2),e("nbranchesVal").textContent=e("nbranches").value,e("freqScaleVal").textContent=Number(e("freqScale").value).toFixed(2),e("octaves")&&(e("octavesVal").textContent=String(parseInt(e("octaves").value,10))),e("burstRate")&&(e("burstRateVal").textContent=Number(e("burstRate").value).toFixed(2)),e("burstDurMs")&&(e("burstDurMsVal").textContent=e("burstDurMs").value),e("impulseGain")&&(e("impulseGainVal").textContent=Number(e("impulseGain").value).toFixed(2)),e("exciterHP")&&(e("exciterHPVal").textContent=e("exciterHP").value),e("freqCenterVal").textContent=e("freqCenter").value,e("decayScaleVal").textContent=Number(e("decayScale").value).toFixed(2),e("groupSplit")&&(e("groupSplitVal").textContent=String(parseInt(e("groupSplit").value,10))),e("exciterBandQNoise")&&(e("exciterBandQNoiseVal").textContent=e("exciterBandQNoise").value),e("exciterBandQRain")&&(e("exciterBandQRainVal").textContent=e("exciterBandQRain").value),e("rainRate")&&(e("rainRateVal").textContent=Number(e("rainRate").value).toFixed(2)),e("rainDurMs")&&(e("rainDurMsVal").textContent=e("rainDurMs").value),e("rainGain")&&(e("rainGainVal").textContent=Number(e("rainGain").value).toFixed(2)),e("rainSpread")&&(e("rainSpreadVal").textContent=Number(e("rainSpread").value).toFixed(2)),e("rainCenter")&&(e("rainCenterVal").textContent=Number(e("rainCenter").value).toFixed(2)),e("rainLimbs")&&(e("rainLimbsVal").textContent=e("rainLimbs").value)}async function we(){if(m)return;m=new(window.AudioContext||window.webkitAudioContext)({sampleRate:44100,latencyHint:"playback"}),a=await P.create(m);const e=m.createGain();e.gain.value=1,e.connect(m.destination);const t=m.createGain();t.gain.value=1;const n=m.createGain();n.gain.value=1;const l=m.createBiquadFilter();l.type="lowpass",l.frequency.value=2e4,a.connect(l,0,0),l.connect(t),a.connect(n,1,0),t.connect(e),n.connect(e);const o=m.createAnalyser();o.fftSize=1024;const r=m.createAnalyser();r.fftSize=1024,t.connect(o),n.connect(r);const i=new Float32Array(o.fftSize),s=new Float32Array(r.fftSize),u=()=>{const d=document.getElementById("meter0Bar"),c=document.getElementById("meter1Bar");if(d&&c){o.getFloatTimeDomainData(i),r.getFloatTimeDomainData(s);let p=0;for(let M=0;M<i.length;M+=1)p+=i[M]*i[M];let S=0;for(let M=0;M<s.length;M+=1)S+=s[M]*s[M];const A=Math.sqrt(p/i.length),xe=Math.sqrt(S/s.length),ye=20*Math.log10(Math.max(1e-6,A)),ve=20*Math.log10(Math.max(1e-6,xe)),Se=Math.max(0,Math.min(1,(ye+60)/60)),Be=Math.max(0,Math.min(1,(ve+60)/60));d.style.height=String(Math.round(Se*100))+"%",c.style.height=String(Math.round(Be*100))+"%"}requestAnimationFrame(u)};requestAnimationFrame(u);let f=1,g=1;window._mixerApi={setNoiseLP(d){l.frequency.setTargetAtTime(Math.max(50,Math.min(2e4,d||2e4)),m.currentTime,.02)},getNoiseLP:()=>l.frequency.value,getContext:()=>m,getNode:()=>a,getMasterOut:()=>e,getNoiseGain:()=>t,getRainGain:()=>n,muteMainStereo(d){d?(f=t.gain.value,g=n.gain.value,t.gain.setTargetAtTime(0,m.currentTime,.02),n.gain.setTargetAtTime(0,m.currentTime,.02)):(t.gain.setTargetAtTime(f,m.currentTime,.02),n.gain.setTargetAtTime(g,m.currentTime,.02))}},console.info("AudioContext started",{sampleRate:m.sampleRate,baseLatency:m.baseLatency});const h=d=>document.getElementById(d),b=["rmix","nbranches","freqScale","octaves","freqCenter","decayScale","groupSplit"],T=["noiseType","lfoRate","lfoDepth","exciterCutoff","exciterHP","exciterBandQNoise","exciterBandQRain","rainRate","rainDurMs","rainGain","rainSpread","rainCenter","rainLimbs"];for(const d of T)document.getElementById(d)&&b.push(d);if(b.forEach(d=>{const c=h(d);c&&c.addEventListener("input",()=>{if(D(),W({[d]:c.type==="checkbox"?!!c.checked:d==="nbranches"||d==="octaves"||d==="groupSplit"?parseInt(c.value,10):parseFloat(c.value)}),!a)return;const p=m.currentTime;switch(d){case"noiseLevel":a.noiseLevel.setValueAtTime(parseFloat(c.value),p);break;case"noiseType":a.noiseType.setValueAtTime(parseInt(c.value,10),p);break;case"rmix":a.rmix.setValueAtTime(parseFloat(c.value),p);break;case"nbranches":{const S=parseInt(c.value,10);a.nbranches.setValueAtTime(S,p),J(S);const A=document.getElementById("groupSplit");A&&(A.max=String(S),parseInt(A.value,10)>S&&(A.value=String(S))),S>w&&Fe(w,S),w=S;break}case"freqScale":a.freqScale.setValueAtTime(parseFloat(c.value),p);break;case"octaves":a.octaves.setValueAtTime(parseInt(c.value,10),p);break;case"exciterCutoff":a.exciterCutoff.setValueAtTime(parseFloat(c.value),p);break;case"exciterHP":a.exciterHP.setValueAtTime(parseFloat(c.value),p);break;case"burstRate":a.burstRate.setValueAtTime(parseFloat(c.value),p);break;case"burstDurMs":a.burstDurMs.setValueAtTime(parseFloat(c.value),p);break;case"impulseGain":a.impulseGain.setValueAtTime(parseFloat(c.value),p);break;case"freqCenter":a.freqCenter.setValueAtTime(parseFloat(c.value),p);break;case"decayScale":a.decayScale.setValueAtTime(parseFloat(c.value),p);break;case"exciterBandQNoise":a.exciterBandQNoise.setValueAtTime(parseFloat(c.value),p);break;case"exciterBandQRain":a.exciterBandQRain.setValueAtTime(parseFloat(c.value),p);break;case"groupSplit":a.groupSplit.setValueAtTime(parseInt(c.value,10),p);break}})}),typeof BroadcastChannel<"u"){const d=new BroadcastChannel("mixer");d.onmessage=c=>{const p=c.data||{};if(p.type==="setNoiseLP"&&typeof p.value=="number")try{l.frequency.setTargetAtTime(Math.max(50,Math.min(2e4,p.value)),m.currentTime,.02)}catch{}}}const E=document.getElementById("groupEnabled");E&&E.addEventListener("change",()=>{a&&(W({groupEnabled:!!E.checked}),a.groupEnabled.setValueAtTime(E.checked?1:0,m.currentTime))});const B=document.getElementById("rainEnabled");B&&B.addEventListener("change",()=>{a&&a.rainEnabled.setValueAtTime(B.checked?1:0,m.currentTime)});const C=document.getElementById("lfoEnabled");C&&C.addEventListener("change",()=>{a&&a.lfoEnabled.setValueAtTime(C.checked?1:0,m.currentTime)});const I=document.getElementById("lfoWave");I&&I.addEventListener("change",()=>{a&&a.lfoWave.setValueAtTime(parseInt(I.value,10),m.currentTime)});const v=document.getElementById("monitorExciter");v&&v.addEventListener("change",()=>{a&&a.monitorExciter.setValueAtTime(v.checked?1:0,m.currentTime)});const k=document.getElementById("scaleRoot"),L=document.getElementById("scaleName"),x=()=>{if(!a)return;const d=L.value,c=k.value;W({scaleName:d,scaleRoot:c}),a.setScale({name:d,root:c}),a.quantize.setValueAtTime(d==="off"?0:1,m.currentTime)};k.addEventListener("change",x),L.addEventListener("change",x);const y=parseInt(document.getElementById("nbranches").value,10)||16;a.nbranches.setValueAtTime(y,m.currentTime),J(y),w=y,(function(){k&&L&&x()})(),Ee(),O()}const te=document.getElementById("branches");if(te)for(let e=0;e<N;e+=1)te.appendChild(Ne(e));const ne=document.getElementById("startBtn");ne&&ne.addEventListener("click",we);const ae=document.getElementById("randomizeBtn");ae&&ae.addEventListener("click",()=>{const e=parseInt(document.getElementById("nbranches").value,10)||16;Ve();const t=parseInt(document.getElementById("nbranches").value,10)||e;qe(t);const n=document.getElementById("scaleRoot"),l=document.getElementById("scaleName"),o=Z(U()||Y());if(!(o.scaleRoot&&o.scaleRoot.enabled||o.scaleName&&o.scaleName.enabled)&&n&&l){const i=Array.from(n.options).map(b=>b.value),s=Array.from(l.options).map(b=>b.value),u=s.filter(b=>b!=="off"),f=b=>b[Math.floor(Math.random()*b.length)],g=f(i),h=f(u.length?u:s);n.value=g,l.value=h,n.dispatchEvent(new Event("change",{bubbles:!0})),l.dispatchEvent(new Event("change",{bubbles:!0}))}});const ie=document.getElementById("resetBtn");ie&&ie.addEventListener("click",()=>{try{localStorage.removeItem(G),localStorage.removeItem(z)}catch{}document.getElementById("noiseLevel")&&(document.getElementById("noiseLevel").value="0.03"),document.getElementById("rmix").value="1",document.getElementById("nbranches").value="4",document.getElementById("freqScale").value="1",document.getElementById("octaves").value="0",document.getElementById("exciterCutoff")&&(document.getElementById("exciterCutoff").value="4000"),document.getElementById("exciterHP")&&(document.getElementById("exciterHP").value="50"),document.getElementById("noiseType")&&(document.getElementById("noiseType").value="0"),document.getElementById("lfoEnabled")&&(document.getElementById("lfoEnabled").checked=!0),document.getElementById("lfoRate")&&(document.getElementById("lfoRate").value="0.10"),document.getElementById("lfoDepth")&&(document.getElementById("lfoDepth").value="0.56"),document.getElementById("lfoWave")&&(document.getElementById("lfoWave").value="0"),document.getElementById("rainEnabled")&&(document.getElementById("rainEnabled").checked=!0),document.getElementById("rainRate")&&(document.getElementById("rainRate").value="0.81"),document.getElementById("rainDurMs")&&(document.getElementById("rainDurMs").value="8"),document.getElementById("rainGain")&&(document.getElementById("rainGain").value="0.85"),document.getElementById("rainSpread")&&(document.getElementById("rainSpread").value="0.69"),document.getElementById("rainCenter")&&(document.getElementById("rainCenter").value="0.55"),document.getElementById("rainLimbs")&&(document.getElementById("rainLimbs").value="9"),document.getElementById("monitorExciter")&&(document.getElementById("monitorExciter").checked=!1),document.getElementById("freqCenter").value="0",document.getElementById("decayScale").value="1",document.getElementById("groupEnabled")&&(document.getElementById("groupEnabled").checked=!1),document.getElementById("groupSplit")&&(document.getElementById("groupSplit").value="0");const e=document.getElementById("exciterBandQNoise");e&&(e.value="30");const t=document.getElementById("exciterBandQRain");if(t&&(t.value="30"),document.getElementById("scaleRoot")&&(document.getElementById("scaleRoot").value="A"),document.getElementById("scaleName")&&(document.getElementById("scaleName").value="off"),D(),a&&m){const n=m.currentTime;a.noiseLevel.setValueAtTime(.03,n),a.noiseType&&a.noiseType.setValueAtTime(1,n),a.lfoEnabled&&a.lfoEnabled.setValueAtTime(1,n),a.lfoRate&&a.lfoRate.setValueAtTime(.1,n),a.lfoDepth&&a.lfoDepth.setValueAtTime(.56,n),a.lfoWave&&a.lfoWave.setValueAtTime(0,n),a.rmix.setValueAtTime(1,n),a.nbranches.setValueAtTime(4,n),a.freqScale.setValueAtTime(1,n),a.octaves.setValueAtTime(0,n),a.exciterCutoff&&a.exciterCutoff.setValueAtTime(4e3,n),a.exciterHP&&a.exciterHP.setValueAtTime(50,n),a.rainEnabled&&a.rainEnabled.setValueAtTime(1,n),a.rainRate&&a.rainRate.setValueAtTime(.83,n),a.rainDurMs&&a.rainDurMs.setValueAtTime(61,n),a.rainGain&&a.rainGain.setValueAtTime(.62,n),a.rainSpread&&a.rainSpread.setValueAtTime(.71,n),a.rainCenter&&a.rainCenter.setValueAtTime(.49,n),a.rainLimbs&&a.rainLimbs.setValueAtTime(10,n),a.monitorExciter&&a.monitorExciter.setValueAtTime(0,n),a.freqCenter.setValueAtTime(0,n),a.decayScale.setValueAtTime(1,n),a.groupEnabled&&a.groupEnabled.setValueAtTime(0,n),a.groupSplit&&a.groupSplit.setValueAtTime(0,n),a.quantize.setValueAtTime(0,n),a.setScale&&a.setScale({name:"off",root:"A"}),J(4),w=4}Ee(),O()});document.getElementById("rmix")&&D();Me();const re=document.getElementById("openControlsBtn");re&&re.addEventListener("click",()=>{window.open("control.html","Exciter Controls")});const oe=document.getElementById("openMixerBtn");oe&&oe.addEventListener("click",()=>{window.open("mixer.html","Mixer")});const le=document.getElementById("openRandomizerBtn");le&&le.addEventListener("click",()=>{window.open("randomizer.html","Randomizer")});const se=document.getElementById("openSpatialBtn");se&&se.addEventListener("click",()=>{window.open("spatial.html","Spatial Mixer")});document.getElementById("randomizerPanel")&&Re();(function(){try{Ie()}catch{}try{const t=ue();if(t)for(const[n,l]of Object.entries(t))Q(n,l)}catch{}})();
