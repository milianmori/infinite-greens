(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();class I extends AudioWorkletNode{static async create(e){try{await e.audioWorklet.addModule("resonator-processor.js")}catch{}return new I(e)}constructor(e){super(e,"resonator-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2],parameterData:{nbranches:4,noiseLevel:.03,noiseType:1,lfoEnabled:1,lfoRate:.1,lfoDepth:.7,lfoWave:0,rmix:1,dryWet:1,quantize:0,exciterCutoff:4e3,exciterHP:50,rainEnabled:1,rainGain:.62,rainRate:.83,rainDurMs:61,rainSpread:.71,rainCenter:.49,rainLimbs:10,monitorExciter:0,groupEnabled:0,groupSplit:0,octaves:0,freqScale:1,freqCenter:0,decayScale:1,exciterBandQ:30}})}get nbranches(){return this.parameters.get("nbranches")}get noiseLevel(){return this.parameters.get("noiseLevel")}get noiseType(){return this.parameters.get("noiseType")}get lfoEnabled(){return this.parameters.get("lfoEnabled")}get lfoRate(){return this.parameters.get("lfoRate")}get lfoDepth(){return this.parameters.get("lfoDepth")}get lfoWave(){return this.parameters.get("lfoWave")}get rmix(){return this.parameters.get("rmix")}get dryWet(){return this.parameters.get("dryWet")}get quantize(){return this.parameters.get("quantize")}get exciterCutoff(){return this.parameters.get("exciterCutoff")}get exciterHP(){return this.parameters.get("exciterHP")}get groupEnabled(){return this.parameters.get("groupEnabled")}get groupSplit(){return this.parameters.get("groupSplit")}get octaves(){return this.parameters.get("octaves")}get rainEnabled(){return this.parameters.get("rainEnabled")}get rainGain(){return this.parameters.get("rainGain")}get rainRate(){return this.parameters.get("rainRate")}get rainDurMs(){return this.parameters.get("rainDurMs")}get rainSpread(){return this.parameters.get("rainSpread")}get rainCenter(){return this.parameters.get("rainCenter")}get rainLimbs(){return this.parameters.get("rainLimbs")}get monitorExciter(){return this.parameters.get("monitorExciter")}get freqScale(){return this.parameters.get("freqScale")}get freqCenter(){return this.parameters.get("freqCenter")}get decayScale(){return this.parameters.get("decayScale")}get exciterBandQ(){return this.parameters.get("exciterBandQ")}setBranchParams(e,{freq:n,decay:i,amp:r,pan:o}){this.port.postMessage({type:"setBranchParams",index:e,params:{freq:n,decay:i,amp:r,pan:o}})}setAllBranches(e){this.port.postMessage({type:"setAllBranches",branches:e})}setScale({name:e,root:n}){this.port.postMessage({type:"setScale",name:e,root:n})}}let c=null,t=null;const D=40,L=["noiseLevel","noiseType","lfoEnabled","lfoRate","lfoDepth","lfoWave","exciterCutoff","exciterHP","exciterBandQ","monitorExciter","rainEnabled","rainGain","rainRate","rainDurMs","rainSpread","rainCenter","rainLimbs"];let B=!1,E=null;function S(a){return document.getElementById(a)}function w(a,e){if(!t||!c)return;const n=c.currentTime;switch(a){case"noiseLevel":t.noiseLevel&&t.noiseLevel.setValueAtTime(parseFloat(e),n);break;case"noiseType":t.noiseType&&t.noiseType.setValueAtTime(parseInt(e,10),n);break;case"lfoEnabled":t.lfoEnabled&&t.lfoEnabled.setValueAtTime(e?1:0,n);break;case"lfoRate":t.lfoRate&&t.lfoRate.setValueAtTime(parseFloat(e),n);break;case"lfoDepth":t.lfoDepth&&t.lfoDepth.setValueAtTime(parseFloat(e),n);break;case"lfoWave":t.lfoWave&&t.lfoWave.setValueAtTime(parseInt(e,10),n);break;case"exciterCutoff":t.exciterCutoff&&t.exciterCutoff.setValueAtTime(parseFloat(e),n);break;case"exciterHP":t.exciterHP&&t.exciterHP.setValueAtTime(parseFloat(e),n);break;case"exciterBandQ":t.exciterBandQ&&t.exciterBandQ.setValueAtTime(parseFloat(e),n);break;case"monitorExciter":t.monitorExciter&&t.monitorExciter.setValueAtTime(e?1:0,n);break;case"rainEnabled":t.rainEnabled&&t.rainEnabled.setValueAtTime(e?1:0,n);break;case"rainGain":t.rainGain&&t.rainGain.setValueAtTime(parseFloat(e),n);break;case"rainRate":t.rainRate&&t.rainRate.setValueAtTime(parseFloat(e),n);break;case"rainDurMs":t.rainDurMs&&t.rainDurMs.setValueAtTime(parseFloat(e),n);break;case"rainSpread":t.rainSpread&&t.rainSpread.setValueAtTime(parseFloat(e),n);break;case"rainCenter":t.rainCenter&&t.rainCenter.setValueAtTime(parseFloat(e),n);break;case"rainLimbs":t.rainLimbs&&t.rainLimbs.setValueAtTime(parseInt(e,10),n);break}}function P(){const a={};for(const e of L){const n=S(e);if(!n){e==="noiseLevel"&&t&&t.noiseLevel&&(a[e]=t.noiseLevel.value);continue}n.type==="checkbox"?a[e]=!!n.checked:a[e]=n.value}return a}function v(a){if(!E)return;const e=a||P();E.postMessage({type:"state",source:"main",state:e,partial:!!a})}function A(a,e){const n=S(a);if(!n){w(a,e);return}B=!0;try{if(n.type==="checkbox")n.checked=!!e,n.dispatchEvent(new Event("change",{bubbles:!0}));else{n.value=String(e);const i=n.tagName==="SELECT"?"change":"input";n.dispatchEvent(new Event(i,{bubbles:!0}))}}finally{B=!1}}function N(){if(!E&&!(typeof BroadcastChannel>"u")){E=new BroadcastChannel("exciter-controls"),E.onmessage=a=>{const e=a.data||{};if(e.source!=="main")if(e.type==="set"&&e.id)A(e.id,e.value);else if(e.type==="setMultiple"&&e.values){const n=Object.entries(e.values);for(const[i,r]of n)A(i,r)}else e.type==="requestState"&&v()};for(const a of L){const e=S(a);if(!e)continue;const n=()=>{if(B)return;const i=e.type==="checkbox"?!!e.checked:e.value;v({[a]:i})};e.addEventListener("input",n),e.addEventListener("change",n)}}}const k=25,R=8e3;function q(a){const e=k,n=R,i=Math.min(Math.max(a,e),n);return Math.log(i/e)/Math.log(n/e)}function F(a){const e=k,n=R,i=Math.min(Math.max(a,0),1);return e*Math.pow(n/e,i)}function y(a,e){return Math.random()*(e-a)+a}function H(a){return Math.round(a*100)/100}function G(a){const e=document.createElement("div");e.className="grid row",e.dataset.index=String(a);const n=document.createElement("span");n.textContent=String(a+1),e.appendChild(n);const i=document.createElement("input");i.type="range",i.min="0",i.max="1",i.step="0.001",i.value=String(q(440)),i.dataset.role="freq",e.appendChild(i);const r=document.createElement("input");r.type="range",r.min="50",r.max="3000",r.step="1",r.value="400",r.dataset.role="decay",e.appendChild(r);const o=document.createElement("input");o.type="range",o.min="0",o.max="1",o.step="0.001",o.value="0.2",o.dataset.role="amp",e.appendChild(o);const s=document.createElement("input");s.type="range",s.min="-1",s.max="1",s.step="0.001",s.value="0",s.dataset.role="pan",e.appendChild(s);const u=()=>{if(!t)return;const d={freq:F(parseFloat(i.value)),decay:parseFloat(r.value),amp:parseFloat(o.value),pan:parseFloat(s.value)};t.setBranchParams(a,d)};return i.addEventListener("input",u),r.addEventListener("input",u),o.addEventListener("input",u),s.addEventListener("input",u),e}function T(a){document.querySelectorAll("#branches .row").forEach((n,i)=>{n.style.display=i<a?"grid":"none"})}function W(a){const e=[],n=document.querySelectorAll("#branches .row");for(let i=0;i<a;i+=1){const r=Math.round(y(100,2e3)),o=Math.round(y(100,800)),s=H(y(.005,.05)),u=y(-1,1);e.push({freq:r,decay:o,amp:s,pan:u});const d=n[i];d.querySelector('input[data-role="freq"]').value=String(q(r)),d.querySelector('input[data-role="decay"]').value=String(o),d.querySelector('input[data-role="amp"]').value=String(s),d.querySelector('input[data-role="pan"]').value=String(u)}t&&t.setAllBranches(e)}function M(){const a=parseInt(document.getElementById("nbranches").value,10)||4,e=document.querySelectorAll("#branches .row"),n=[];for(let i=0;i<a;i+=1){const r=e[i],o=parseFloat(r.querySelector('input[data-role="freq"]').value),s=parseFloat(r.querySelector('input[data-role="decay"]').value),u=parseFloat(r.querySelector('input[data-role="pan"]').value),d=r.querySelector('input[data-role="amp"]');d&&(d.value="0.2"),n.push({freq:F(o),decay:s,amp:.2,pan:u})}t&&t.setAllBranches(n),h()}function h(){const a=e=>document.getElementById(e);a("noiseLevel")&&(a("noiseLevelVal").textContent=Number(a("noiseLevel").value).toFixed(2)),a("rmixVal").textContent=Number(a("rmix").value).toFixed(2),a("nbranchesVal").textContent=a("nbranches").value,a("freqScaleVal").textContent=Number(a("freqScale").value).toFixed(2),a("octaves")&&(a("octavesVal").textContent=String(parseInt(a("octaves").value,10))),a("burstRate")&&(a("burstRateVal").textContent=Number(a("burstRate").value).toFixed(2)),a("burstDurMs")&&(a("burstDurMsVal").textContent=a("burstDurMs").value),a("impulseGain")&&(a("impulseGainVal").textContent=Number(a("impulseGain").value).toFixed(2)),a("exciterHP")&&(a("exciterHPVal").textContent=a("exciterHP").value),a("freqCenterVal").textContent=a("freqCenter").value,a("decayScaleVal").textContent=Number(a("decayScale").value).toFixed(2),a("groupSplit")&&(a("groupSplitVal").textContent=String(parseInt(a("groupSplit").value,10))),a("exciterBandQ")&&(a("exciterBandQVal").textContent=a("exciterBandQ").value),a("rainRate")&&(a("rainRateVal").textContent=Number(a("rainRate").value).toFixed(2)),a("rainDurMs")&&(a("rainDurMsVal").textContent=a("rainDurMs").value),a("rainGain")&&(a("rainGainVal").textContent=Number(a("rainGain").value).toFixed(2)),a("rainSpread")&&(a("rainSpreadVal").textContent=Number(a("rainSpread").value).toFixed(2)),a("rainCenter")&&(a("rainCenterVal").textContent=Number(a("rainCenter").value).toFixed(2)),a("rainLimbs")&&(a("rainLimbsVal").textContent=a("rainLimbs").value)}async function Q(){if(c)return;c=new(window.AudioContext||window.webkitAudioContext)({sampleRate:44100,latencyHint:"playback"}),t=await I.create(c),t.connect(c.destination),console.info("AudioContext started",{sampleRate:c.sampleRate,baseLatency:c.baseLatency});const a=f=>document.getElementById(f),e=["rmix","nbranches","freqScale","octaves","freqCenter","decayScale","groupSplit"],n=["noiseType","lfoRate","lfoDepth","exciterCutoff","exciterHP","exciterBandQ","rainRate","rainDurMs","rainGain","rainSpread","rainCenter","rainLimbs"];for(const f of n)document.getElementById(f)&&e.push(f);e.forEach(f=>{const l=a(f);l&&l.addEventListener("input",()=>{if(h(),!t)return;const m=c.currentTime;switch(f){case"noiseLevel":t.noiseLevel.setValueAtTime(parseFloat(l.value),m);break;case"noiseType":t.noiseType.setValueAtTime(parseInt(l.value,10),m);break;case"rmix":t.rmix.setValueAtTime(parseFloat(l.value),m);break;case"nbranches":{const g=parseInt(l.value,10);t.nbranches.setValueAtTime(g,m),T(g);const b=document.getElementById("groupSplit");b&&(b.max=String(g),parseInt(b.value,10)>g&&(b.value=String(g)));break}case"freqScale":t.freqScale.setValueAtTime(parseFloat(l.value),m);break;case"octaves":t.octaves.setValueAtTime(parseInt(l.value,10),m);break;case"exciterCutoff":t.exciterCutoff.setValueAtTime(parseFloat(l.value),m);break;case"exciterHP":t.exciterHP.setValueAtTime(parseFloat(l.value),m);break;case"burstRate":t.burstRate.setValueAtTime(parseFloat(l.value),m);break;case"burstDurMs":t.burstDurMs.setValueAtTime(parseFloat(l.value),m);break;case"impulseGain":t.impulseGain.setValueAtTime(parseFloat(l.value),m);break;case"freqCenter":t.freqCenter.setValueAtTime(parseFloat(l.value),m);break;case"decayScale":t.decayScale.setValueAtTime(parseFloat(l.value),m);break;case"exciterBandQ":t.exciterBandQ.setValueAtTime(parseFloat(l.value),m);break;case"groupSplit":t.groupSplit.setValueAtTime(parseInt(l.value,10),m);break}})});const i=document.getElementById("groupEnabled");i&&i.addEventListener("change",()=>{t&&t.groupEnabled.setValueAtTime(i.checked?1:0,c.currentTime)});const r=document.getElementById("rainEnabled");r&&r.addEventListener("change",()=>{t&&t.rainEnabled.setValueAtTime(r.checked?1:0,c.currentTime)});const o=document.getElementById("lfoEnabled");o&&o.addEventListener("change",()=>{t&&t.lfoEnabled.setValueAtTime(o.checked?1:0,c.currentTime)});const s=document.getElementById("lfoWave");s&&s.addEventListener("change",()=>{t&&t.lfoWave.setValueAtTime(parseInt(s.value,10),c.currentTime)});const u=document.getElementById("monitorExciter");u&&u.addEventListener("change",()=>{t&&t.monitorExciter.setValueAtTime(u.checked?1:0,c.currentTime)});const d=document.getElementById("scaleRoot"),p=document.getElementById("scaleName"),x=()=>{if(!t)return;const f=p.value,l=d.value;t.setScale({name:f,root:l}),t.quantize.setValueAtTime(f==="off"?0:1,c.currentTime)};d.addEventListener("change",x),p.addEventListener("change",x);const V=parseInt(document.getElementById("nbranches").value,10)||16;t.nbranches.setValueAtTime(V,c.currentTime),T(V),(function(){d&&p&&x()})(),M(),v()}const z=document.getElementById("branches");for(let a=0;a<D;a+=1)z.appendChild(G(a));document.getElementById("startBtn").addEventListener("click",Q);document.getElementById("randomizeBtn").addEventListener("click",()=>{const a=parseInt(document.getElementById("nbranches").value,10)||16;W(a);const e=document.getElementById("scaleRoot"),n=document.getElementById("scaleName");if(e&&n){const i=Array.from(e.options).map(p=>p.value),r=Array.from(n.options).map(p=>p.value),o=r.filter(p=>p!=="off"),s=p=>p[Math.floor(Math.random()*p.length)],u=s(i),d=s(o.length?o:r);e.value=u,n.value=d,e.dispatchEvent(new Event("change",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0}))}});document.getElementById("resetBtn").addEventListener("click",()=>{document.getElementById("noiseLevel")&&(document.getElementById("noiseLevel").value="0.03"),document.getElementById("rmix").value="1",document.getElementById("nbranches").value="4",document.getElementById("freqScale").value="1",document.getElementById("octaves").value="0",document.getElementById("exciterCutoff")&&(document.getElementById("exciterCutoff").value="4000"),document.getElementById("exciterHP")&&(document.getElementById("exciterHP").value="50"),document.getElementById("noiseType")&&(document.getElementById("noiseType").value="0"),document.getElementById("lfoEnabled")&&(document.getElementById("lfoEnabled").checked=!0),document.getElementById("lfoRate")&&(document.getElementById("lfoRate").value="0.10"),document.getElementById("lfoDepth")&&(document.getElementById("lfoDepth").value="0.56"),document.getElementById("lfoWave")&&(document.getElementById("lfoWave").value="0"),document.getElementById("rainEnabled")&&(document.getElementById("rainEnabled").checked=!0),document.getElementById("rainRate")&&(document.getElementById("rainRate").value="0.81"),document.getElementById("rainDurMs")&&(document.getElementById("rainDurMs").value="8"),document.getElementById("rainGain")&&(document.getElementById("rainGain").value="0.85"),document.getElementById("rainSpread")&&(document.getElementById("rainSpread").value="0.69"),document.getElementById("rainCenter")&&(document.getElementById("rainCenter").value="0.55"),document.getElementById("rainLimbs")&&(document.getElementById("rainLimbs").value="9"),document.getElementById("monitorExciter")&&(document.getElementById("monitorExciter").checked=!1),document.getElementById("freqCenter").value="0",document.getElementById("decayScale").value="1",document.getElementById("groupEnabled")&&(document.getElementById("groupEnabled").checked=!1),document.getElementById("groupSplit")&&(document.getElementById("groupSplit").value="0");const a=document.getElementById("exciterBandQ");if(a&&(a.value="30"),document.getElementById("scaleRoot")&&(document.getElementById("scaleRoot").value="A"),document.getElementById("scaleName")&&(document.getElementById("scaleName").value="off"),h(),t&&c){const e=c.currentTime;t.noiseLevel.setValueAtTime(.03,e),t.noiseType&&t.noiseType.setValueAtTime(1,e),t.lfoEnabled&&t.lfoEnabled.setValueAtTime(1,e),t.lfoRate&&t.lfoRate.setValueAtTime(.1,e),t.lfoDepth&&t.lfoDepth.setValueAtTime(.56,e),t.lfoWave&&t.lfoWave.setValueAtTime(0,e),t.rmix.setValueAtTime(1,e),t.nbranches.setValueAtTime(4,e),t.freqScale.setValueAtTime(1,e),t.octaves.setValueAtTime(0,e),t.exciterCutoff&&t.exciterCutoff.setValueAtTime(4e3,e),t.exciterHP&&t.exciterHP.setValueAtTime(50,e),t.rainEnabled&&t.rainEnabled.setValueAtTime(1,e),t.rainRate&&t.rainRate.setValueAtTime(.83,e),t.rainDurMs&&t.rainDurMs.setValueAtTime(61,e),t.rainGain&&t.rainGain.setValueAtTime(.62,e),t.rainSpread&&t.rainSpread.setValueAtTime(.71,e),t.rainCenter&&t.rainCenter.setValueAtTime(.49,e),t.rainLimbs&&t.rainLimbs.setValueAtTime(10,e),t.monitorExciter&&t.monitorExciter.setValueAtTime(0,e),t.freqCenter.setValueAtTime(0,e),t.decayScale.setValueAtTime(1,e),t.groupEnabled&&t.groupEnabled.setValueAtTime(0,e),t.groupSplit&&t.groupSplit.setValueAtTime(0,e),t.quantize.setValueAtTime(0,e),t.setScale&&t.setScale({name:"off",root:"A"}),T(4)}M(),v()});h();N();const C=document.getElementById("openControlsBtn");C&&C.addEventListener("click",()=>{window.open("control.html","Exciter Controls")});
