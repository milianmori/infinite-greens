<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spatial Mixer</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      .sp-card { padding: 12px; background: #0f172a; border-radius: 8px; margin-bottom: 12px; }
      .sp-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
      #stage { width: 100%; height: 320px; background:#020617; border:1px solid #334155; border-radius:8px; touch-action:none; }
      .row { display:grid; grid-template-columns: 24px 1fr 1fr 1fr 1fr; gap:8px; align-items:center; }
      .row label { font-size: 12px; color:#94a3b8 }
      .row.header span { font-size: 12px; color:#94a3b8; font-weight:600 }
      .row input[type="range"], .row input[type="number"] { width: 100%; }
      .controls { display:flex; gap:8px; flex-wrap:wrap }
      .controls button { padding:6px 10px }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Spatial Mixer</h1>
        <div class="controls">
          <button id="attachBtn">Attach to Main</button>
          <button id="randomAllBtn">Randomize All</button>
          <input id="seedInput" type="text" placeholder="seed (optional)" style="width:140px" />
          <label style="display:flex; align-items:center; gap:6px; font-size:12px; color:#94a3b8">
            <span id="boundsLabel">Bounds x,y [-5,5] z [-2,2]</span>
          </label>
        </div>
      </header>

      <div class="sp-grid">
        <div class="sp-card">
          <h3>Top-down Stage</h3>
          <canvas id="stage"></canvas>
          <div class="controls" style="margin-top:8px">
            <button id="presetRoom">Small Room</button>
            <button id="presetHall">Hall</button>
            <button id="presetOutside">Outside</button>
          </div>
          <div class="row" style="grid-template-columns: 100px 1fr 60px; margin-top:8px">
            <label>View Zoom</label>
            <input id="viewZoom" type="range" min="4" max="40" step="0.1" value="12" />
            <input id="viewZoomn" type="number" step="0.1" value="12" />
          </div>
        </div>
        <div class="sp-card">
          <h3>Listener & Room</h3>
          <div class="row"><span></span><label>World XY ±</label><input id="worldXY" type="range" min="1" max="50" step="0.1" value="5" /><input id="worldXYn" type="number" step="0.1" value="5" /><span></span></div>
          <div class="row"><span></span><label>World Z ±</label><input id="worldZ" type="range" min="0.5" max="20" step="0.1" value="2" /><input id="worldZn" type="number" step="0.1" value="2" /><span></span></div>
          <div class="row"><span></span><label>Listener X</label><input id="lx" type="range" min="-5" max="5" step="0.01" value="0" /><input id="lxn" type="number" step="0.01" value="0" /><span></span></div>
          <div class="row"><span></span><label>Listener Y</label><input id="ly" type="range" min="-5" max="5" step="0.01" value="0" /><input id="lyn" type="number" step="0.01" value="0" /><span></span></div>
          <div class="row"><span></span><label>Listener Z</label><input id="lz" type="range" min="-2" max="2" step="0.01" value="0" /><input id="lzn" type="number" step="0.01" value="0" /><span></span></div>
          <div class="row"><span></span><label>Yaw (deg)</label><input id="yaw" type="range" min="-180" max="180" step="1" value="0" /><input id="yawn" type="number" step="1" value="0" /><span></span></div>
          <div class="row"><span></span><label>Master X</label><input id="mx" type="range" min="-5" max="5" step="0.01" value="0" /><input id="mxn" type="number" step="0.01" value="0" /><span></span></div>
          <div class="row"><span></span><label>Master Y</label><input id="my" type="range" min="-5" max="5" step="0.01" value="0" /><input id="myn" type="number" step="0.01" value="0" /><span></span></div>
          <div class="row"><span></span><label>Master Z</label><input id="mz" type="range" min="-2" max="2" step="0.01" value="0" /><input id="mzn" type="number" step="0.01" value="0" /><span></span></div>
          <div class="row"><span></span><label>Reference Distance</label><input id="refDistance" type="range" min="0.01" max="5" step="0.01" value="1" /><input id="refDistn" type="number" step="0.01" value="1" /><span></span></div>
          <div class="row"><span></span><label>Distance Rolloff</label><input id="rolloffFactor" type="range" min="0" max="5" step="0.01" value="1" /><input id="rolloffFactorn" type="number" step="0.01" value="1" /><span></span></div>
          <div class="row"><span></span><label>Maximum Distance</label><input id="maxDistance" type="range" min="1" max="50" step="0.1" value="25" /><input id="maxDistn" type="number" step="0.1" value="25" /><span></span></div>
          <div class="row"><span></span><label>Inner Cone Angle (deg)</label><input id="coneInner" type="range" min="0" max="360" step="1" value="60" /><input id="coneInnern" type="number" step="1" value="60" /><span></span></div>
          <div class="row"><span></span><label>Outer Cone Angle (deg)</label><input id="coneOuter" type="range" min="0" max="360" step="1" value="90" /><input id="coneOutern" type="number" step="1" value="90" /><span></span></div>
          <div class="row"><span></span><label>Outside Cone Gain</label><input id="coneOuterGain" type="range" min="0" max="1" step="0.01" value="0.3" /><input id="coneOuterGainn" type="number" step="0.01" value="0.3" /><span></span></div>
          <div class="row" style="grid-template-columns: 1fr; margin-top:8px">
            <label><input id="bypassSpatial" type="checkbox" /> Bypass Spatial (send branches directly to mixer)</label>
          </div>
          <div class="row" style="grid-template-columns: 100px 1fr 60px">
            <label>Reverb Wet</label>
            <input id="reverbWet" type="range" min="0" max="1" step="0.01" value="0.2" />
            <input id="reverbWetn" type="number" step="0.01" value="0.2" />
          </div>
          <div class="row" style="grid-template-columns: 100px 1fr 60px">
            <label>Reverb Time (s)</label>
            <input id="reverbTime" type="range" min="0.1" max="6" step="0.1" value="2.3" />
            <input id="reverbTimen" type="number" step="0.1" value="2.3" />
          </div>
          <div class="row" style="grid-template-columns: 120px 1fr 60px">
            <label>Reverb Near</label>
            <input id="reverbNear" type="range" min="0" max="10" step="0.01" value="0.7" />
            <input id="reverbNearn" type="number" step="0.01" value="0.7" />
          </div>
          <div class="row" style="grid-template-columns: 120px 1fr 60px">
            <label>Reverb Far</label>
            <input id="reverbFar" type="range" min="0.5" max="25" step="0.01" value="12" />
            <input id="reverbFarn" type="number" step="0.01" value="12" />
          </div>
          <div class="row" style="grid-template-columns: 120px 1fr 60px">
            <label>Reverb Curve</label>
            <input id="reverbCurve" type="range" min="0.1" max="4" step="0.01" value="1.2" />
            <input id="reverbCurven" type="number" step="0.01" value="1.2" />
          </div>
          <div class="row" style="grid-template-columns: 120px 1fr 60px">
            <label>Reverb Gain (dB)</label>
            <input id="reverbGainDb" type="range" min="0" max="12" step="0.1" value="0" />
            <input id="reverbGainDbn" type="number" step="0.1" value="0" />
          </div>
          <div class="row" style="grid-template-columns: 1fr; margin-top:8px">
            <label><input id="autoEnable" type="checkbox" /> Auto Listener Path</label>
          </div>
          <div class="row" style="grid-template-columns: 120px 1fr 60px">
            <label>Auto Speed</label>
            <input id="autoSpeed" type="range" min="0.05" max="10" step="0.01" value="1" />
            <input id="autoSpeedn" type="number" step="0.01" value="1" />
          </div>
          <div class="row" style="grid-template-columns: 120px 1fr 60px">
            <label>Approach Radius</label>
            <input id="autoApproach" type="range" min="0.05" max="5" step="0.01" value="0.5" />
            <input id="autoApproachn" type="number" step="0.01" value="0.5" />
          </div>
          <div class="row" style="grid-template-columns: 120px 1fr 60px">
            <label>Dwell (s)</label>
            <input id="autoDwell" type="range" min="0" max="5" step="0.01" value="0.3" />
            <input id="autoDwelln" type="number" step="0.01" value="0.3" />
          </div>
          <div class="row" style="grid-template-columns: 1fr; margin-top:8px">
            <label><input id="autoYaw" type="checkbox" checked /> Auto Yaw (face motion)</label>
          </div>
          <div class="row" style="grid-template-columns: 120px 1fr 60px">
            <label>Yaw Rate (deg/s)</label>
            <input id="autoYawRate" type="range" min="0" max="360" step="1" value="120" />
            <input id="autoYawRaten" type="number" step="1" value="120" />
          </div>
        </div>
      </div>

      <div class="sp-card">
        <h3>Branches</h3>
        <div class="row header">
          <span>#</span>
          <span>Gain</span>
          <span>X</span>
          <span>Y</span>
          <span>Z</span>
        </div>
        <div id="branchRows"></div>
      </div>
    </div>

      <button id="floatingRandomizeBtn" class="floating-randomize">Randomize</button>

    <script type="module" src="spatial.js"></script>
  </body>
  </html>


