<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spatial Mixer</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      .sp-card { padding: 12px; background: #0f172a; border-radius: 8px; margin-bottom: 12px; }
      .sp-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
      #stage { width: 100%; height: 320px; background:#020617; border:1px solid #334155; border-radius:8px; touch-action:none; }
      .row { display:grid; grid-template-columns: 24px 1fr 1fr 1fr 1fr; gap:8px; align-items:center; }
      .row label { font-size: 12px; color:#94a3b8 }
      .row.header span { font-size: 12px; color:#94a3b8; font-weight:600 }
      .row input[type="range"], .row input[type="number"] { width: 100%; }
      .controls { display:flex; gap:8px; flex-wrap:wrap }
      .controls button { padding:6px 10px }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Spatial Mixer</h1>
        <div class="controls">
          <button id="attachBtn">Attach to Main</button>
          <button id="randomAllBtn">Randomize All</button>
          <input id="seedInput" type="text" placeholder="seed (optional)" style="width:140px" />
          <label style="display:flex; align-items:center; gap:6px; font-size:12px; color:#94a3b8">
            Bounds x,y [-5,5] z [-2,2]
          </label>
        </div>
      </header>

      <div class="sp-grid">
        <div class="sp-card">
          <h3>Top-down Stage</h3>
          <canvas id="stage"></canvas>
          <div class="controls" style="margin-top:8px">
            <button id="presetRoom">Small Room</button>
            <button id="presetHall">Hall</button>
            <button id="presetOutside">Outside</button>
          </div>
        </div>
        <div class="sp-card">
          <h3>Listener & Room</h3>
          <div class="row"><span></span><label>Listener X</label><input id="lx" type="range" min="-5" max="5" step="0.01" value="0" /><input id="lxn" type="number" step="0.01" value="0" /><span></span></div>
          <div class="row"><span></span><label>Listener Y</label><input id="ly" type="range" min="-5" max="5" step="0.01" value="0" /><input id="lyn" type="number" step="0.01" value="0" /><span></span></div>
          <div class="row"><span></span><label>Listener Z</label><input id="lz" type="range" min="-2" max="2" step="0.01" value="0" /><input id="lzn" type="number" step="0.01" value="0" /><span></span></div>
          <div class="row"><span></span><label>Yaw (deg)</label><input id="yaw" type="range" min="-180" max="180" step="1" value="0" /><input id="yawn" type="number" step="1" value="0" /><span></span></div>
          <div class="row"><span></span><label>refDistance</label><input id="refDistance" type="range" min="0.01" max="5" step="0.01" value="1" /><input id="refDistn" type="number" step="0.01" value="1" /><span></span></div>
          <div class="row"><span></span><label>rolloffFactor</label><input id="rolloffFactor" type="range" min="0" max="5" step="0.01" value="1" /><input id="rolloffFactorn" type="number" step="0.01" value="1" /><span></span></div>
          <div class="row"><span></span><label>maxDistance</label><input id="maxDistance" type="range" min="1" max="50" step="0.1" value="25" /><input id="maxDistn" type="number" step="0.1" value="25" /><span></span></div>
          <div class="row"><span></span><label>coneInner (deg)</label><input id="coneInner" type="range" min="0" max="360" step="1" value="60" /><input id="coneInnern" type="number" step="1" value="60" /><span></span></div>
          <div class="row"><span></span><label>coneOuter (deg)</label><input id="coneOuter" type="range" min="0" max="360" step="1" value="90" /><input id="coneOutern" type="number" step="1" value="90" /><span></span></div>
          <div class="row"><span></span><label>coneOuterGain</label><input id="coneOuterGain" type="range" min="0" max="1" step="0.01" value="0.3" /><input id="coneOuterGainn" type="number" step="0.01" value="0.3" /><span></span></div>
          <div class="row" style="grid-template-columns: 1fr; margin-top:8px">
            <label><input id="bypassSpatial" type="checkbox" /> Bypass Spatial (send branches directly to mixer)</label>
          </div>
          <div class="row" style="grid-template-columns: 100px 1fr 60px">
            <label>Reverb Wet</label>
            <input id="reverbWet" type="range" min="0" max="1" step="0.01" value="0.2" />
            <input id="reverbWetn" type="number" step="0.01" value="0.2" />
          </div>
          <div class="row" style="grid-template-columns: 100px 1fr 60px">
            <label>Reverb Time (s)</label>
            <input id="reverbTime" type="range" min="0.1" max="6" step="0.1" value="2.3" />
            <input id="reverbTimen" type="number" step="0.1" value="2.3" />
          </div>
        </div>
      </div>

      <div class="sp-card">
        <h3>Branches</h3>
        <div class="row header">
          <span>#</span>
          <span>Gain</span>
          <span>X</span>
          <span>Y</span>
          <span>Z</span>
        </div>
        <div id="branchRows"></div>
      </div>
    </div>

    <script type="module" src="spatial.js"></script>
  </body>
  </html>


