var Ea=(_,e)=>()=>(e||_((e={exports:{}}).exports,e),e.exports);var Ca=Ea(()=>{function R(_,e,a){return Math.max(e,Math.min(a,_))}function st(_,e,a){return _===e?_:_+(e-_)*a}function Ba(_){if(_<=0)return 0;let e=Math.round(69+12*Math.log2(_/440));return 440*Math.pow(2,(e-69)/12)}var ft=class extends AudioWorkletProcessor{static get parameterDescriptors(){return[{name:"nbranches",defaultValue:16,minValue:1,maxValue:40,automationRate:"k-rate"},{name:"noiseLevel",defaultValue:.1,minValue:0,maxValue:.5,automationRate:"a-rate"},{name:"noiseType",defaultValue:0,minValue:0,maxValue:3,automationRate:"k-rate"},{name:"lfoEnabled",defaultValue:0,minValue:0,maxValue:1,automationRate:"k-rate"},{name:"lfoRate",defaultValue:2,minValue:.1,maxValue:20,automationRate:"k-rate"},{name:"lfoDepth",defaultValue:.5,minValue:0,maxValue:1,automationRate:"k-rate"},{name:"lfoWave",defaultValue:0,minValue:0,maxValue:3,automationRate:"k-rate"},{name:"rmix",defaultValue:.5,minValue:0,maxValue:1,automationRate:"a-rate"},{name:"quantize",defaultValue:0,minValue:0,maxValue:1,automationRate:"k-rate"},{name:"exciterCutoff",defaultValue:4e3,minValue:20,maxValue:2e4,automationRate:"k-rate"},{name:"exciterHP",defaultValue:50,minValue:10,maxValue:2e3,automationRate:"k-rate"},{name:"groupEnabled",defaultValue:0,minValue:0,maxValue:1,automationRate:"k-rate"},{name:"groupSplit",defaultValue:0,minValue:0,maxValue:40,automationRate:"k-rate"},{name:"rainEnabled",defaultValue:0,minValue:0,maxValue:1,automationRate:"k-rate"},{name:"rainGain",defaultValue:.3,minValue:0,maxValue:1,automationRate:"k-rate"},{name:"rainRate",defaultValue:6,minValue:.1,maxValue:40,automationRate:"k-rate"},{name:"rainDurMs",defaultValue:8,minValue:1,maxValue:200,automationRate:"k-rate"},{name:"rainSpread",defaultValue:.4,minValue:0,maxValue:1,automationRate:"k-rate"},{name:"rainCenter",defaultValue:.5,minValue:0,maxValue:1,automationRate:"k-rate"},{name:"rainLimbs",defaultValue:5,minValue:1,maxValue:10,automationRate:"k-rate"},{name:"monitorExciter",defaultValue:0,minValue:0,maxValue:1,automationRate:"k-rate"},{name:"freqScale",defaultValue:1,minValue:.25,maxValue:4,automationRate:"k-rate"},{name:"octaves",defaultValue:0,minValue:-4,maxValue:4,automationRate:"k-rate"},{name:"freqCenter",defaultValue:0,minValue:-2e3,maxValue:2e3,automationRate:"k-rate"},{name:"decayScale",defaultValue:1,minValue:.25,maxValue:4,automationRate:"k-rate"},{name:"exciterBandQNoise",defaultValue:25,minValue:.5,maxValue:80,automationRate:"k-rate"},{name:"exciterBandQRain",defaultValue:25,minValue:.5,maxValue:80,automationRate:"k-rate"}]}constructor(){super();let e=sampleRate;this.branchFreqHz=new Float32Array(40),this.branchDecayMs=new Float32Array(40),this.branchAmp=new Float32Array(40),this.branchPan=new Float32Array(40),this.smoothFreqHz=new Float32Array(40),this.smoothAmp=new Float32Array(40),this.smoothPan=new Float32Array(40),this.smoothMix=.5,this.leftPanGain=new Float32Array(40),this.rightPanGain=new Float32Array(40),this.two_a=new Float32Array(40),this.two_b=new Float32Array(40),this.two_c=new Float32Array(40),this.two_y1=new Float32Array(40),this.two_y2=new Float32Array(40),this.c_r=new Float32Array(40),this.c_rcos=new Float32Array(40),this.c_rsin=new Float32Array(40),this.c_ry1=new Float32Array(40),this.c_iy1=new Float32Array(40),this.bpN_b0=new Float32Array(40),this.bpN_b1=new Float32Array(40),this.bpN_b2=new Float32Array(40),this.bpN_a1=new Float32Array(40),this.bpN_a2=new Float32Array(40),this.bpR_b0=new Float32Array(40),this.bpR_b1=new Float32Array(40),this.bpR_b2=new Float32Array(40),this.bpR_a1=new Float32Array(40),this.bpR_a2=new Float32Array(40),this.bpN_x1=new Float32Array(40),this.bpN_x2=new Float32Array(40),this.bpN_y1=new Float32Array(40),this.bpN_y2=new Float32Array(40),this.bpR_x1=new Float32Array(40),this.bpR_x2=new Float32Array(40),this.bpR_y1=new Float32Array(40),this.bpR_y2=new Float32Array(40),this.cachedEffFreq=new Float32Array(40),this.cachedEffDecay=new Float32Array(40),this.alphaFreq=5e-4,this.alphaAmp=7e-4,this.alphaMix=7e-4,this.twopi=Math.PI*2,this.twopiOverSR=this.twopi/e,this.mssr=-1e3/e,this.ex_b0=1,this.ex_b1=0,this.ex_b2=0,this.ex_a1=0,this.ex_a2=0,this.ex_x1=0,this.ex_x2=0,this.ex_y1=0,this.ex_y2=0,this.hpf_x1=0,this.hpf_y1=0,this.hpf_a=0,this.rainEnv=new Float32Array(40),this.MAX_LIMBS=16,this.rainNextSamples=new Int32Array(this.MAX_LIMBS);for(let a=0;a<this.MAX_LIMBS;a+=1)this.rainNextSamples[a]=1;this.lfoPhase=0,this.lfoSH=0,this.prevWhite=0,this.brown=0,this.pk_b0=0,this.pk_b1=0,this.pk_b2=0,this.twoN_y1=new Float32Array(40),this.twoN_y2=new Float32Array(40),this.cN_ry1=new Float32Array(40),this.cN_iy1=new Float32Array(40),this.twoR_y1=new Float32Array(40),this.twoR_y2=new Float32Array(40),this.cR_ry1=new Float32Array(40),this.cR_iy1=new Float32Array(40);for(let a=0;a<40;a+=1)this.branchFreqHz[a]=440,this.branchDecayMs[a]=400,this.branchAmp[a]=.02,this.branchPan[a]=0,this.smoothFreqHz[a]=this.branchFreqHz[a],this.smoothAmp[a]=this.branchAmp[a],this.smoothPan[a]=this.branchPan[a],this.updatePanGains(a),this.cachedEffFreq[a]=0,this.cachedEffDecay[a]=0,this.recomputeCoefficients(a,440,400),this.recomputeBandpassCoefficientsNoise(a,440,25),this.recomputeBandpassCoefficientsRain(a,440,25),this.twoN_y1[a]=0,this.twoN_y2[a]=0,this.cN_ry1[a]=0,this.cN_iy1[a]=0,this.twoR_y1[a]=0,this.twoR_y2[a]=0,this.cR_ry1[a]=0,this.cR_iy1[a]=0,this.bpN_x1[a]=0,this.bpN_x2[a]=0,this.bpN_y1[a]=0,this.bpN_y2[a]=0,this.bpR_x1[a]=0,this.bpR_x2[a]=0,this.bpR_y1[a]=0,this.bpR_y2[a]=0;this.rngState=(2654435769^(e|0))>>>0,this.prevBandQNoise=25,this.prevBandQRain=25,this.scaleConfig={name:"off",root:"A"},this.scalePitchClasses=null,this.port.onmessage=a=>{let s=a.data||{};if(s.type==="setBranchParams"){let{index:i,params:n}=s;i>=0&&i<40&&n&&(typeof n.freq=="number"&&(this.branchFreqHz[i]=n.freq),typeof n.decay=="number"&&(this.branchDecayMs[i]=Math.max(1,n.decay)),typeof n.amp=="number"&&(this.branchAmp[i]=Math.max(0,n.amp)),typeof n.pan=="number"&&(this.branchPan[i]=R(n.pan,-1,1),this.smoothPan[i]=this.branchPan[i],this.updatePanGains(i)))}else if(s.type==="setAllBranches"){let i=s.branches||[],n=Math.min(i.length,40);for(let o=0;o<n;o+=1){let r=i[o]||{};this.branchFreqHz[o]=typeof r.freq=="number"?r.freq:440,this.branchDecayMs[o]=typeof r.decay=="number"?Math.max(1,r.decay):400,this.branchAmp[o]=typeof r.amp=="number"?Math.max(0,r.amp):.02,this.branchPan[o]=typeof r.pan=="number"?R(r.pan,-1,1):0,this.smoothFreqHz[o]=this.branchFreqHz[o],this.smoothAmp[o]=this.branchAmp[o],this.smoothPan[o]=this.branchPan[o],this.updatePanGains(o),this.cachedEffFreq[o]=0,this.cachedEffDecay[o]=0}}else if(s.type==="setScale"){let i=s.name||"off",n=s.root||"A";this.scaleConfig={name:i,root:n},this.scalePitchClasses=this.computePitchClasses(i,n)}}}nextRand(){let e=this.rngState|0;return e^=e<<13,e^=e>>>17,e^=e<<5,this.rngState=e>>>0,this.rngState*23283064365386963e-26}nextSigned(){return this.nextRand()*2-1}updatePanGains(e){let s=(R(this.smoothPan[e],-1,1)+1)*.5,i=Math.cos(s*Math.PI*.5),n=Math.sin(s*Math.PI*.5);this.leftPanGain[e]=i,this.rightPanGain[e]=n}recomputeCoefficients(e,a,s){let i=sampleRate,n=this.twopi*a/i,r=Math.E/Math.max(.001,s*.001)*this.twopiOverSR,h=Math.exp(-.5*r),b=2*Math.cos(n)*h,M=-Math.exp(-r),f=1-(M+b);this.two_a[e]=f,this.two_b[e]=b,this.two_c[e]=M;let c=Math.exp(this.mssr/(Math.max(1,s)*.08));this.c_r[e]=c,this.c_rcos[e]=c*Math.cos(n),this.c_rsin[e]=c*Math.sin(n)}recomputeBandpassCoefficientsNoise(e,a,s){let i=sampleRate,n=2*Math.PI*Math.max(1,Math.min(i*.45,a))/i,o=Math.cos(n),r=Math.sin(n),h=Math.max(.5,s),l=r/(2*h),b=h*l,M=0,f=-h*l,c=1+l,N=-2*o,S=1-l;this.bpN_b0[e]=b/c,this.bpN_b1[e]=M/c,this.bpN_b2[e]=f/c,this.bpN_a1[e]=N/c,this.bpN_a2[e]=S/c}recomputeBandpassCoefficientsRain(e,a,s){let i=sampleRate,n=2*Math.PI*Math.max(1,Math.min(i*.45,a))/i,o=Math.cos(n),r=Math.sin(n),h=Math.max(.5,s),l=r/(2*h),b=h*l,M=0,f=-h*l,c=1+l,N=-2*o,S=1-l;this.bpR_b0[e]=b/c,this.bpR_b1[e]=M/c,this.bpR_b2[e]=f/c,this.bpR_a1[e]=N/c,this.bpR_a2[e]=S/c}process(e,a,s){let i=a[0],n=i&&i[0],o=i&&i[1],r=a[1],h=r&&r[0],l=r&&r[1],b=n.length,M=s.nbranches,f=s.noiseLevel,c=s.rmix,N=s.quantize,S=s.freqScale,g=s.octaves,it=s.freqCenter,nt=s.decayScale,P=s.exciterCutoff,X=s.exciterHP,k=s.groupEnabled,q=s.groupSplit,v=s.noiseType,G=s.lfoEnabled,D=s.lfoRate,Q=s.lfoDepth,I=s.lfoWave,z=s.rainEnabled,T=s.rainGain,L=s.rainRate,W=s.rainDurMs,O=s.rainSpread,j=s.rainCenter,J=s.rainLimbs,K=s.monitorExciter,U=s.exciterBandQNoise,Y=s.exciterBandQRain,Lt=(S.length===1,S[0]),Wt=(it.length===1,it[0]),Ot=(nt.length===1,nt[0]),m=R(M[0]|0,0,40),jt=U&&(U.length===1,U[0])||25,Jt=Y&&(Y.length===1,Y[0])||25,ot=Math.max(.5,Math.min(80,jt)),ht=Math.max(.5,Math.min(80,Jt)),At=Math.abs(ot-this.prevBandQNoise)>1e-6,Rt=Math.abs(ht-this.prevBandQRain)>1e-6,Kt=P&&(P.length===1,P[0]),Ut=Math.max(20,Math.min(2e4,Kt||4e3)),Mt=2*Math.PI*Ut/sampleRate,Z=Math.cos(Mt),yt=Math.sin(Mt)/(2*.70710678),Yt=(1-Z)/2,Zt=1-Z,$t=(1-Z)/2,C=1+yt,ta=-2*Z,aa=1-yt;this.ex_b0=Yt/C,this.ex_b1=Zt/C,this.ex_b2=$t/C,this.ex_a1=ta/C,this.ex_a2=aa/C;let ea=X&&(X.length===1,X[0]),sa=Math.max(10,Math.min(2e3,ea||50)),xt=1/(2*Math.PI*sa),ia=1/sampleRate;this.hpf_a=xt/(xt+ia);let na=G&&(G.length===1,G[0]>=.5),oa=Math.max(.1,D&&(D.length===1,D[0])||2),Nt=Math.max(0,Math.min(1,Q&&(Q.length===1,Q[0])||.5)),dt=I&&(I.length===1,I[0]|0),ha=z&&(z.length===1,z[0]>=.5),rt=k&&(k.length===1,k[0]>=.5),wt=q&&(q.length===1,q[0]),St=Math.max(0,Math.min(40,Math.round(wt===void 0?0:wt)))|0,ra=K&&(K.length===1,K[0]>=.5);for(let p=0;p<b;p+=1){let ca=f.length>1?f[p]:f[0],Et=1;if(na){this.lfoPhase+=oa/sampleRate,this.lfoPhase>=1&&(this.lfoPhase-=1,dt===3&&(this.lfoSH=this.nextSigned()));let t;switch(dt){default:t=Math.sin(this.lfoPhase*2*Math.PI);break;case 1:{let y=this.lfoPhase;t=4*Math.abs(y-Math.round(y))-1;break}case 2:t=this.lfoPhase<.5?1:-1;break;case 3:t=this.lfoSH;break}Et=1-Nt+Nt*((t+1)*.5)}let x=this.nextSigned()*(ca*Et),$=v&&(v.length===1,v[0]|0),d;if($===0)d=x*.2;else if($===1)this.pk_b0=.99765*this.pk_b0+.099046*x,this.pk_b1=.963*this.pk_b1+.2965164*x,this.pk_b2=.57*this.pk_b2+1.0526913*x,d=this.pk_b0+this.pk_b1+this.pk_b2+.1848*x,d*=.05;else if($===2)this.brown=(this.brown+x*.02)*.998,this.brown>1?this.brown=1:this.brown<-1&&(this.brown=-1),d=this.brown;else if($===3){let t=x-this.prevWhite;this.prevWhite=x,d=t*.5}else d=x*.2;let ct=this.hpf_a*(this.hpf_y1+d-this.hpf_x1);this.hpf_x1=d,this.hpf_y1=ct;let lt=this.ex_b0*ct+this.ex_b1*this.ex_x1+this.ex_b2*this.ex_x2-this.ex_a1*this.ex_y1-this.ex_a2*this.ex_y2;this.ex_x2=this.ex_x1,this.ex_x1=ct,this.ex_y2=this.ex_y1,this.ex_y1=lt;let la=Math.max(.1,L&&(L.length===1,L[0])||6),pa=Math.max(1,W&&(W.length===1,W[0])||8),ma=Math.max(0,T&&(T.length===1,T[0])||.3),_a=Math.max(0,Math.min(1,O&&(O.length===1,O[0])||.4)),ua=Math.max(0,Math.min(1,j&&(j.length===1,j[0])||.5)),Bt=Math.max(1,Math.min(10,J&&(J.length===1,J[0])||5))|0,ba=Math.exp(-1/Math.max(1,pa*.001*sampleRate));if(ha&&Bt>0&&m>0)for(let t=0;t<Bt;t+=1){let y=this.rainNextSamples[t]|0;if(y<=0){let B=Math.round(ua*(m-1)),pt=Math.max(.5,_a*(m-1)*.5),mt=this.nextRand()||1e-10,V=this.nextRand(),tt=Math.sqrt(-2*Math.log(mt))*Math.cos(2*Math.PI*V),u=Math.round(B+pt*tt);if(u<0?u=0:u>=m&&(u=m-1),rt){let E=Math.max(0,Math.min(m,St));u<E&&(u=E+u%Math.max(1,m-E),u>=m&&(u=m-1))}let _t=1;this.rainEnv[u]+=_t;let A=this.nextRand()||1e-12,Dt=-Math.log(A)/la,F=Math.max(1,Math.round(Dt*sampleRate));this.rainNextSamples[t]=F}else this.rainNextSamples[t]=y-1}for(let t=0;t<m;t+=1)this.rainEnv[t]*=ba;let fa=c.length>1?c[p]:c[0];this.smoothMix=st(this.smoothMix,fa,this.alphaMix);let Ct=0,Vt=0,Ft=0,Ht=0,gt=0,Pt=0,Xt=0,kt=0,qt=0,vt=0,Gt=0,Aa=rt?Math.max(0,Math.min(m,St)):0;for(let t=0;t<m;t+=1){let y=this.branchFreqHz[t],B=this.branchAmp[t],pt=this.branchPan[t],mt=this.smoothFreqHz[t]=st(this.smoothFreqHz[t],y,this.alphaFreq),V=this.smoothAmp[t]=st(this.smoothAmp[t],B,this.alphaAmp),tt=this.smoothPan[t]=st(this.smoothPan[t],pt,this.alphaAmp);if((p&7)===0){this._prevPanForGains||(this._prevPanForGains=new Float32Array(40));let w=this._prevPanForGains[t];Math.abs(tt-w)>.001&&(this._prevPanForGains[t]=tt,this.updatePanGains(t))}let u=g&&(g.length===1,g[0]),_t=Math.pow(2,u||0),A=R(mt*Lt*_t+Wt,25,sampleRate*.45);if((N&&(N.length===1,N[0]))>=.5){let w=this.scalePitchClasses;!w||w.length===0?A=Ba(A):A=this.quantizeToScale(A,w)}let F=Math.max(1,this.branchDecayMs[t]*Ot),E=Math.abs(A-this.cachedEffFreq[t])>.1,Ra=Math.abs(F-this.cachedEffDecay[t])>.1;(E||Ra)&&(this.cachedEffFreq[t]=A,this.cachedEffDecay[t]=F,this.recomputeCoefficients(t,A,F)),(E||At)&&this.recomputeBandpassCoefficientsNoise(t,A,ot),(E||Rt)&&this.recomputeBandpassCoefficientsRain(t,A,ht);let Qt=ma*this.rainEnv[t],ut=lt,bt=Qt;if(rt){let w=t<Aa;ut=w?lt:0,bt=w?0:Qt}let at=this.bpN_b0[t]*ut+this.bpN_b1[t]*this.bpN_x1[t]+this.bpN_b2[t]*this.bpN_x2[t]-this.bpN_a1[t]*this.bpN_y1[t]-this.bpN_a2[t]*this.bpN_y2[t];this.bpN_x2[t]=this.bpN_x1[t],this.bpN_x1[t]=ut,this.bpN_y2[t]=this.bpN_y1[t],this.bpN_y1[t]=at;let et=this.bpR_b0[t]*bt+this.bpR_b1[t]*this.bpR_x1[t]+this.bpR_b2[t]*this.bpR_x2[t]-this.bpR_a1[t]*this.bpR_y1[t]-this.bpR_a2[t]*this.bpR_y2[t];this.bpR_x2[t]=this.bpR_x1[t],this.bpR_x1[t]=bt,this.bpR_y2[t]=this.bpR_y1[t],this.bpR_y1[t]=et;let Ma=this.two_a[t]*at+this.two_b[t]*this.twoN_y1[t]+this.two_c[t]*this.twoN_y2[t];this.twoN_y2[t]=this.twoN_y1[t],this.twoN_y1[t]=R(Ma,-1,1);let ya=at*.02+this.c_rcos[t]*this.cN_ry1[t]-this.c_rsin[t]*this.cN_iy1[t],xa=this.c_rsin[t]*this.cN_ry1[t]+this.c_rcos[t]*this.cN_iy1[t];this.cN_ry1[t]=R(ya,-1,1),this.cN_iy1[t]=R(xa,-1,1);let Na=(1-this.smoothMix)*this.twoN_y1[t]+this.smoothMix*this.cN_ry1[t],da=this.two_a[t]*et+this.two_b[t]*this.twoR_y1[t]+this.two_c[t]*this.twoR_y2[t];this.twoR_y2[t]=this.twoR_y1[t],this.twoR_y1[t]=R(da,-1,1);let wa=et*.02+this.c_rcos[t]*this.cR_ry1[t]-this.c_rsin[t]*this.cR_iy1[t],Sa=this.c_rsin[t]*this.cR_ry1[t]+this.c_rcos[t]*this.cR_iy1[t];this.cR_ry1[t]=R(wa,-1,1),this.cR_iy1[t]=R(Sa,-1,1);let It=(1-this.smoothMix)*this.twoR_y1[t]+this.smoothMix*this.cR_ry1[t],zt=Na*V;Ct+=zt*this.leftPanGain[t],Vt+=zt*this.rightPanGain[t];let Tt=It*V;Ft+=Tt*this.leftPanGain[t],Ht+=Tt*this.rightPanGain[t];let H=It*V;switch(t%5){case 0:gt+=H;break;case 1:Pt+=H;break;case 2:Xt+=H;break;case 3:kt+=H;break;case 4:qt+=H;break}vt+=at,Gt+=et}if(ra){let t=m>0?m:1,y=vt/t,B=Gt/t;n&&(n[p]=y,o[p]=y),h&&(h[p]=B,l[p]=B)}else{n&&(n[p]=Ct,o[p]=Vt),h&&(h[p]=Ft,l[p]=Ht);let t=a[2];t&&t.length>=5&&(t[0][p]=gt,t[1][p]=Pt,t[2][p]=Xt,t[3][p]=kt,t[4][p]=qt)}}return At&&(this.prevBandQNoise=ot),Rt&&(this.prevBandQRain=ht),!0}noteNameToClass(e){let a={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,Fb:4,"E#":5,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11,Cb:11,"B#":0};return a[e]!=null?a[e]:9}computePitchClasses(e,a){if(!e||e==="off")return null;let s=this.noteNameToClass(a||"A"),n={chromatic:[0,1,2,3,4,5,6,7,8,9,10,11],major:[0,2,4,5,7,9,11],minor:[0,2,3,5,7,8,10],harmonicMinor:[0,2,3,5,7,8,11],melodicMinor:[0,2,3,5,7,9,11],dorian:[0,2,3,5,7,9,10],phrygian:[0,1,3,5,7,8,10],lydian:[0,2,4,6,7,9,11],mixolydian:[0,2,4,5,7,9,10],locrian:[0,1,3,5,6,8,10],pentatonicMajor:[0,2,4,7,9],pentatonicMinor:[0,3,5,7,10],blues:[0,3,5,6,7,10],wholeTone:[0,2,4,6,8,10],octatonic12:[0,1,3,4,6,7,9,10],octatonic21:[0,2,3,5,6,8,9,11]}[e]||null;if(!n)return null;let o=n.map(h=>(s+h)%12);return Array.from(new Set(o)).sort((h,l)=>h-l)}quantizeToScale(e,a){if(!(e>0))return 0;let s=69+12*Math.log2(e/440),i=Math.round(s),n=(i%12+12)%12;if(a.indexOf(n)!==-1)return 440*Math.pow(2,(i-69)/12);let o=i,r=1/0;for(let h=0;h<=12;h+=1){let l=i+h,b=i-h,M=(l%12+12)%12,f=(b%12+12)%12;if(a.indexOf(M)!==-1){o=l,r=h;break}if(a.indexOf(f)!==-1){o=b,r=h;break}}return 440*Math.pow(2,(o-69)/12)}};registerProcessor("resonator-processor",ft)});export default Ca();
